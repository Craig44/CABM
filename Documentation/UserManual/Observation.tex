\section{The observation section\label{sec:observation-section}}
This section describes the observations that \IBM\ can generate during run time. \IBM\ calculates expectations of all the agents that are user defined, and then adds observation error via simulating through a distribution with a user defined observation error value.
\subsection{\I{Observations}\label{sec:Observations}\index{Observations}}

\subsubsection{Process Removals By Age}\label{subsubsec:catch_at_age}\index{Observations!Process Removals By Age}
This observation class aggregates age frequency over a user defined spatial are from a \subcommand{mortality\_event\_biomass} and \subcommand{mortality\_baranov} process. This class can add ageing error onto the expectation, to account for ageing error which is a source of uncertainty in ageing fish. An example of how you would set this observation up and show some of the flexibilities in the spatial resolution see the syntax below for a 6 area model.

{\small{\begin{verbatim}
@process fishing
type mortality_event_biomass
years 2000
catch_layers catch_2000
selectivity fishing_selectivity

@layer catch_2000
type numeric
table_layer
600 500 400
1034 601 200
903 450 100
end_table

@layer cells
type categorical
table_layer
r1-c1 r1-c2 r1-c3
r2-c1 r2-c2 r2-c3
r3-c1 r3-c2 r3-c3
end_table

@observation fishery_age
type process_removals_by_age
cell_layer cells
cells r1-c1 r1-c2 r1-c3 r2-c1 r2-c2 r2-c3 r3-c1 r3-c2 r3-c3
simulation_likelihood multinomial
process_label fishing
years 2000
min_age 0
max_age 28
plus_group true
table error_values
2000 10000
end_table
\end{verbatim}}}

The above syntax asks for an age frequency for each cell in the spatial domain through the link to the categorical layer. You could easily summarise the age frequency over the whole spatial domain by changing the categorical layer as shown below

{\small{\begin{verbatim}
@layer cells
type categorical
table_layer
single_cell single_cell single_cell
single_cell single_cell single_cell
single_cell single_cell single_cell
end_table

@observation fishery_age
type process_removals_by_age
cell_layer cells
cells single_cell
simulation_likelihood multinomial
process_label fishing
years 2000
min_age 0
max_age 28
plus_group true
table error_values
2000 10000
end_table
\end{verbatim}}}

Hopefully the above example illustrates how much control the user has in specifying what information they want to extract.

\subsubsection{Biomass}\label{subsubsec:biomass}\index{Observations!Biomass}
This observation summarises the biomass over a selected number of agents in a time step over the mortality block (Section~\ref{sec:mortality_block})

{\small{\begin{verbatim}
@observation survey_index
type biomass
years 1990:2013
time_step Summer
catchability 0.342
proportion_through_mortality_block 1.0 ## take snapshot at the end of timestep
simulation_likelihood lognormal
error_value 0.2 * 24
selectivities Sel_survey
cell_layer cells
cells r1-c1 r2-c1 r3-c1 
\end{verbatim}}}

\subsubsection{Proportions at age}\label{subsubsec:Proportions_at_age}\index{Observations!Proportions at age}
This observation summarises the proportions at age for selected number of agents in a time step over the mortality block (Section~\ref{sec:mortality_block})

{\small{\begin{verbatim}
@observation survey_age_comp
type proportions_at_age
simulation_likelihood multinomial
years 1990:1995
min_age 0
max_age 20
plus_group true
ageing_error none
table error_values
1990 300
1991 300
1992 300
1993 300
1994 300
1995 300
end_table
cell_layer cells
cells r1-c1 r2-c1 r3-c1
\end{verbatim}}}




\subsubsection{Age frequency from scaled length frequency}\label{subsubsec:Mortalitysubsamle}\index{Observations!Mortality sub sample}
This observation class, generates a age frequency that assumes  gets all the agents removed by an F method in each cell, and returns a sub-sample of age and lengths. The user can ask for ageing-error to be applied to the ages using the \command{ageing\_error} block (see Section~\ref{subsec:ageing_error}). The user must supply a categorical layer that represents stratum to weight the final age frequency by, this weight can be biomass weighted or area weighted.


\subsection{\I{Ageing error}}\label{subsec:ageing_error}
\IBM\ can apply ageing error to an expected age frequency generated by the model. The ageing error is applied as a misclassification matrix, which has the effect of 'smearing' the expected age frequencies. This is mimicking the error involved in identifying the age of individuals. For example fish species are aged by reading the ear bones (otoliths) which can be quite difficult depending on the species. These are used in generating age based observations. 

Ageing error is optional, and if it is used, it may be omitted for any individual time series. Different ageing error models may be applied for different observation commands. See Section \ref{sec:ageingerrorreport} for reporting the misclassification matrix at the end of model run.

The ageing error models implemented are,
\begin{enumerate}
	\item{None}: The default model is to apply no ageing error.
	\item{Off by one}: Proportion $p_1$ of individuals of each age $a$ are misclassified as age $a-1$ and proportion $p_2$ are misclassified as age $a+1$. Individuals of age $a < k$ are not misclassified. If there is no plus group in the population model, then proportion $p_2$ of the oldest age class will 'fall off the edge' and disappear. 
	\item{Normal}: Individuals of age $a$ are classified as ages which are normally distributed with mean $a$ and constant c.v. $c$. As above, if there is no plus group in the population model, some individuals of the older age classes may disappear. If $c$ is high enough, some of the younger age classes may 'fall off the other edge'. Individuals of age $a < k$ are not misclassified.
\end{enumerate}

Note that the expected and simulated observations reported by \IBM\ for observations with ageing error will have had the ageing error applied. 



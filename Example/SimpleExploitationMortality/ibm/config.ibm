@model
start_year 1975
final_year 2012
min_age 1
max_age 50
age_plus true # other acceptable inputs for bool are '1' and 'yes'
initialisation_phase_labels Iterative #label to an @initialisation block
time_steps step1 step2 step3 
length_bins 2 4 6 8 10 12 14 16 18 20 22 24 26 28 30 32 34 36 38 40 42 44 46 48 50 52 54 56 58 60 62 64 66 68 70 72 74 76 78 80 82 84 86 88 90 92 94 96 98 100 102 104 106 108 110 112 114 116 118 120 122 124 126 128 130 132 134 136 138 140
length_plus true
base_layer_label Base #
growth_process_label schnute
natural_mortality_process_label natural_mort
#sexed false
maturity_ogive_label MaturationSel
## a single area model
nrows 1
ncols 1 

# --------------
# Init Phase
# --------------
@initialisation_phase Iterative
type iterative
years 70
#convergence_years 20 40
#lambda 1
initial_number_of_agents 700000 ## initial number of agents
layer_label Base
#recruitment_layer_label recruitment_labels
# --------------
# Annual Time Sequence
# --------------

@time_step step1
processes Recruitment schnute half_natural_mort fishing half_natural_mort

@time_step step2
processes schnute natural_mort

@time_step step3
processes  schnute Ageing natural_mort


@process Ageing
type ageing
# --------------
# Process definitions
# --------------
# Growth
/*
@process von_bert
type growth_von_bertalanffy_with_basic_weight
#linf_layer_label L_inf_layer
linf 101.8
#k_layer_label k_layer
k 0.161
a 2.0e-9 
b 3.288
update_growth_parameters false
distribution lognormal
cv 0.1
time_step_proportions 1
*/

@process schnute
type growth_schnute_with_basic_weight
y1 24.5
y2 104.8
tau1 1
tau2 20
alpha 0.131
beta 1.70
a 2.0e-9
b 3.288
update_growth_parameters false
distribution lognormal
cv 0.00000001
time_step_proportions 0.25 0.5 0.25

# Natural Mortality
@process natural_mort
type mortality_constant_rate
update_mortality_parameters false
m_multiplier_layer_label M_layer
m 0.19
time_step_ratio 0.25 0.33
distribution lognormal
cv 0.00000001
selectivity_label One

@process half_natural_mort
type mortality_constant_rate
update_mortality_parameters false
m_multiplier_layer_label M_layer
m 0.19
time_step_ratio 0.42 
distribution lognormal
cv 0.00000001
selectivity_label half

# Fishing Mortality
@process fishing
type mortality_exploitation
print_census_info true
table u_table
year FishingEast FishingWest
!include "Fishing_u_table.ibm"
end_table

table method_info
method 	 	selectivity	 	minimum_legel_length  handling_mortality
FishingEast     eastFSel	0			0
FishingWest		westFSel	0			0
end_table




# Recruitment Beverton Holt
@process Recruitment
type recruitment_beverton_holt
recruitment_layer_label recruit_layer
r0 6625457
steepness 0.9
ycs_values   	      1 1.69 1.726 1.753 1.769 1.772 1.757 1.72 1.679 1.654 0.704 0.786 0.858 0.63 0.869 0.734 1.112 1.656 1.255 1.078 0.977 0.806 0.53 0.5 0.365 0.549 0.363 0.542 1.526 0.867 0.717 0.309 0.507 0.428 0.381 0.429 3 3
ssb SSB

/*
# Constant
@process Recruitment_const
type recruitment_constant
recruitment_layer_label recruit_layer
r0 4632169.3
ssb SSB
*/
# --------------
# Define selectivities
# --------------
@selectivity natural_mortality_by_age
type double_exponential
x1 0
x0 6
x2 30
y1 0.6
y0 0.1
y2 0.4

@selectivity One
type constant
c 1
@selectivity half
type constant
c 0.5

@selectivity MaturationSel
type all_values_bounded
l 2
h 13
v 0.02	0.05	0.13	0.29	0.50	0.70	0.84	0.93	0.97	0.99	0.99	1.00

@selectivity westFSel
type double_normal
mu 6.44798
sigma_l  3.00327
sigma_r 7.88331
alpha 1.0

@selectivity eastFSel
type double_normal
mu 10.8129
sigma_l  3.50265
sigma_r 6.86988
alpha 1.0

@selectivity chatTANSel
type double_normal
mu 9.51995
sigma_l 5.53388
sigma_r 10.8664
alpha 1.0

# --------------
# Derived Quantities
# --------------
@derived_quantity SSB
type biomass
selectivity MaturationSel
biomass_layer_label SSB_areas
time_step step1
proportion_through_mortality_block 0.5

/*
@derived_quantity total_biomass
type biomass
biomass_layer_label SSB_areas
selectivity One
time_step step1
proportion_through_mortality_block 0.5

@derived_quantity total_abundance
type abundance
layer_label SSB_areas
selectivity One
time_step step1
proportion_through_mortality_block 0.5

*/
# --------------
# Define Reports
# --------------
# print process properties
@report M_report
type process
process natural_mort

@report fishing
type process
process fishing

@report Rec
type process
process Recruitment

/*
@report Recruitment_report
type process
process Recruitment
*/

# print initail state of agents
@report init
type initialisation_partition

# print age frequency
@report total_age_freq_1
type world_age_frequency
#years 1975:2012 ## defaults to model years
time_step step1

@report total_age_freq_2
type world_age_frequency
#years 1975:2012 ## defaults to model years
time_step step2

@report total_age_freq_3
type world_age_frequency
#years 1975:2012 ## defaults to model years
time_step step3

# print SSB's
@report derived_quants
type derived_quantity

# print SSB's
@report model_attributes
type model_attributes

# summarises a random selection of agents at each time step of each year, useful when debugging new processes
@report agents_1
type summarise_agents
number_of_agents 1000
time_step step1
years 1976 1977

@report agents_2
type summarise_agents
number_of_agents 1000
time_step step2
years 1976 1977

@report agents_3
type summarise_agents
number_of_agents 1000
time_step step3
years 1976 1977

# --------------
# Include Layers
# --------------
!include "Layers/base_layer.ibm"
!include "Layers/lat.ibm"
!include "Layers/long.ibm"
!include "Layers/SSB_area.ibm"
#!include "Layers/L_inf_layer.ibm"
#!include "Layers/k_layer.ibm"
!include "Layers/M_layer.ibm"
!include "Layers/recruitment_areas.ibm"
## Catch layers
!include includes.ibm



